<?xml version="1.0" encoding="utf-8" ?>
<project name="Jaguar" default="build" basedir=".">
  <!-- Configure path to GWT SDK -->
	<target name="define">
		<property name="webapps.dir.jaguar" value="../dist/build/webapps" />
		<property name="classes.dir.jaguar" value="${webapps.dir.jaguar}/WEB-INF/classes" />
		<property name="lib.dir.jaguar" value="${webapps.dir.jaguar}/WEB-INF/lib" />
		<property name="plugins.dir.jaguar" value="../../gwtplugins" />
		<path id="project.class.path">
		  <pathelement location="war/WEB-INF/classes"/>
		  <pathelement location="${classes.dir.jaguar}"/>
		  <fileset dir="${lib.dir.jaguar}" includes="**/*.jar"/>
		</path>
	</target>

	<target name="build" depends="clean-war,gwtc,resources,copy-war">	

	</target>

 	<target name="resources" description="Copy libs, resources, web.xml etc. and other files to WAR">
		<mkdir dir="war/jaguar"/>		
		<copy todir="war/jaguar/resources">
			<fileset dir="../GWTUtils/resources" />
		</copy>
		<copy file="../GWTUtils/Autocomplete.css" tofile="war/jaguar/Autocomplete.css" />
		<copy file="src/lib/web.xml" tofile="war/WEB-INF/web.xml" />
	  </target>

	<target name="javac" depends="define" description="Compile java source">
	    <ant dir="../" target="build"/>
	    <mkdir dir="war/WEB-INF/classes"/>
	    <javac srcdir="src/java" includes="**/*.java" encoding="utf-8"
		destdir="war/WEB-INF/classes"
		source="1.5" target="1.5" nowarn="true"
		debug="true" debuglevel="lines,vars,source">
	      <classpath refid="project.class.path"/>
	    </javac>
	    <javac srcdir="${plugins.dir.jaguar}" includes="**/*.java" encoding="utf-8"
		destdir="war/WEB-INF/classes"
		source="1.5" target="1.5" nowarn="true"
		debug="true" debuglevel="lines,vars,source">
	      <classpath refid="project.class.path"/>
	    </javac>
		<copy todir="${classes.dir.jaguar}">
			<fileset dir="war/WEB-INF/classes" />
		</copy>
	</target>
	
	<target name='copy-classes' depends="define">
		<copy todir="${classes.dir.jaguar}">
			<fileset dir="war/WEB-INF/classes" />
		</copy>
	</target>

	<target name="calculate-plugins">
		<java failonerror="true" fork="true" classname="compiler.Compiler">
		      <classpath>
			<pathelement location="war/WEB-INF/classes"/>
		      </classpath>
		      <jvmarg value="-Xmx512M"/>
	    	</java>
	</target>

	<target name="gwtc" depends="javac,calculate-plugins" description="GWT compile to JavaScript">
	    <java failonerror="true" fork="true" classname="com.google.gwt.dev.Compiler">
	      <classpath>
		<pathelement location="src/java"/>
		<pathelement location="${plugins.dir.jaguar}"/>
		<path refid="project.class.path"/>
	      </classpath>
	      <jvmarg value="-Xmx512M"/>
	      <!-- Additional arguments like -style PRETTY or -logLevel DEBUG -->
	      <arg value="com.tbitsGlobal.jaguar.Jaguar"/>
	    </java>
	  </target>

	<target name="clean-war">
		<delete dir="war" failonerror="false" />
	</target>

	<target name='copy-war' depends="define">
		<mkdir dir="${webapps.dir.jaguar}/jaguar"/>
		<mkdir dir="${webapps.dir.jaguar}/tmp"/>

		<copy todir="${webapps.dir.jaguar}/jaguar">
			<fileset dir="war/jaguar" />
		</copy>
	</target>
</project>
