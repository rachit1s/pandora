<html xmlns="http://www.w3.org/1999/xhtml">
<head>

<script type="text/javascript" src="cal.js"></script>
<script type="text/javascript" src="json.js"></script>

<script type="text/javascript" language="JavaScript1.2">

    var xmlHttp

    function createreport(reqparameters)
    {
        xmlHttp=GetXmlHttpObject();
        if (xmlHttp==null)
        {
            alert ("Your browser does not support AJAX!");
            return;
        }
        var url="http://nehra:81/repconf"+"?"+reqparameters;
        xmlHttp.onreadystatechange=stateChanged;
        xmlHttp.open("GET",url,true);
        xmlHttp.send(null);
    }

    function stateChanged()
    {
        if (xmlHttp.readyState==4)
        {
			alert(xmlHttp.responseXML);
            var xmlDoc=xmlHttp.responseXML.documentElement;
            document.getElementById("companyname").innerHTML=
            xmlDoc.getElementsByTagName("compname")[0].childNodes[0].nodeValue;
            document.getElementById("contactname").innerHTML=
            xmlDoc.getElementsByTagName("contname")[0].childNodes[0].nodeValue;
            document.getElementById("address").innerHTML=
            xmlDoc.getElementsByTagName("address")[0].childNodes[0].nodeValue;
            document.getElementById("city").innerHTML=
            xmlDoc.getElementsByTagName("city")[0].childNodes[0].nodeValue;
            document.getElementById("country").innerHTML=
            xmlDoc.getElementsByTagName("country")[0].childNodes[0].nodeValue;
        }
    }

    function GetXmlHttpObject()
    {
        var xmlHttp=null;
        try
        {
            // Firefox, Opera 8.0+, Safari
            xmlHttp=new XMLHttpRequest();
        }
        catch (e)
        {
            // Internet Explorer
            try
            {
                xmlHttp=new ActiveXObject("Msxml2.XMLHTTP");
            }
            catch (e)
            {
                xmlHttp=new ActiveXObject("Microsoft.XMLHTTP");
            }
        }
        return xmlHttp;
    }
</script>


<script type="text/javascript" >
function calendarSetup()
{
    Calendar.setup({
        inputField : "startdate",
        button : "_start_date_img_cal",
        ifFormat : "%m/%d/%Y",
        showsTime : "false",
        timeFormat : "24"
    });
}
function showreportselector(type){

    if(type == 'custom')
    {
        document.getElementById('wizardholder').style.display =  'block';
        document.getElementById('blockselector').style.display = 'none';
    }
    else if(type == 'block')
    {
        document.getElementById('blockselector').style.display = 'block';
        document.getElementById('wizardholder').style.display =  'none';
    }

}

function schedulepagenation(){
    document.getElementById('schedule').style.display = 'block';
    document.getElementById('report').style.display =  'none';
}

function schedulepagenationback(){
    document.getElementById('schedule').style.display = 'none';
    document.getElementById('report').style.display =  'block';
}


function submitform(formsubmit){

    var reportname = formsubmit.reportname.value;
    var reportdesc = formsubmit.reportdescription.value;
    var reporttype = ((formsubmit.reportype[0].checked) ? 'custom':'block');
    var customfile = formsubmit.customfile.value;
    var startdate = formsubmit.starttime.value;
    var starttime = formsubmit.startdate.value;

    var v = document.getElementById("sRight");
    var blocklist = assign(v);
    var blockarray = new Array();
    blockarray = blocklist.split(',');

    var emailaddlist = formsubmit.maillist.value;
    var emailaddarray = new Array();
    emailaddarray = emailaddlist.split(',');

    var repeattype = formsubmit.reptype.value;
    var reppattern = '';

    if(repeattype == 'Monthly'){

        if(document.getElementById('repdom').checked)
            reppattern = 'dom';

        else if(document.getElementById('repdow').checked)
            reppattern = 'dow';

    }else if(repeattype == 'Weekly'){
        if(document.getElementById('mon').checked)
            reppattern += ',MON';
        if(document.getElementById('tue').checked)
            reppattern += ', TUE';
        if(document.getElementById('wed').checked)
            reppattern += ', WED';
        if(document.getElementById('thu').checked)
            reppattern += ', THU';
        if(document.getElementById('fri').checked)
            reppattern += ', FRI';
        if(document.getElementById('sat').checked)
            reppattern += ', SAT';
        if(document.getElementById('sun').checked)
            reppattern += ', SUN';

        if(reppattern.indexOf(',')==0)
            reppattern = reppattern.substring(1);

    }

    var cronexp = formcron( repeattype,
            document.getElementById('rec').value,
            reppattern,
            starttime,
            startdate
            );

    alert('cronexp: '+cronexp);
    var reqparameters = "reportname="+reportname +
                        "&reportdesc="+ reportdesc +
                        "&reporttype="+ reporttype +
                        "&customfile="+ customfile +
                        "&blockarray="+ blockarray +
                        "&emailaddarray="+ emailaddarray +
                        "&cronexp="+ cronexp;

    createreport(reqparameters);
    var newreport = {
        "reportname":reportname,
        "reportdesc":reportdesc,
        "reporttype":reporttype,
        "customfile":customfile,
        "blocks":blockarray,
        "emailadd":emailaddarray,
        "cronexp":cronexp,
        "startdate":startdate
    };

}


function formcron(reporttype, rectype, reppattern, startdate, starttime){
    var cron;

    var datearray = new Array();
    datearray = startdate.split('/');

    var timearray = new Array();
    timearray = starttime.split(':');

    var currentday = "MON";

    switch(reporttype)
            {
        case "Daily":
            cron = "0 " + timearray[1] + " " + timearray[0] + " " + datearray[0] + "/" + rectype + " " + datearray[1] + " ? " + datearray[2];
            break;

        case "Every weekday (Mon-Fri)":
            cron = "0 " + timearray[1] + " " + timearray[0] + " ? " + "MON-FRI";
            break;

        case "Every Mon., Wed., and Fri.":
            cron = "0 " + timearray[1] + " " + timearray[0] + " ? " + "MON, WED, FRI";
            break;

        case "Every Tues., and Thurs.":
            cron = "0 " + timearray[1] + " " + timearray[0] + " ? " + "TUE, THU";
            break;

        case "Weekly":
            cron = "0 " + timearray[1] + " " + timearray[0]  + " ? " + reppattern ;
            break;

        case "Monthly":
            if(reppattern == 'dom'){
                cron = "0 " + timearray[1] + " " + timearray[0] + " " + datearray[0] +" */" +rectype;

            } else{
                cron = "0 " + timearray[1] + " " + timearray[0] + " ? */" +rectype+" "+currentday ;

            }
            break;

        case "Yearly":
            cron = "0 " + timearray[1] + " " + timearray[0] + " " + datearray[0] + "/" + rectype + " " + datearray[1] + " ? " + "*/"+rectype;
            break;
    }
    return cron;
}

function scheduletype(schtype){

    if(schtype == 'Does not repeat'){
        document.getElementById('scheduledetails').style.display =  'none';
    }
    else{
        switch(schtype)
                {

            case "Daily":
                document.getElementById('scheduledetails').style.display =  'block';
                document.getElementById('rec').innerHTML = "Repeat every:";
                document.getElementById('recform').innerHTML = '<select id="rec" name="Select1"><option value="1">1</option>      <option value="2">2</option>      <option value="3">3</option>      <option value="4">4</option>      <option value="5">5</option>      <option value="6">6</option>      <option value="7">7</option>      <option value="8">8</option>      <option value="9">9</option>      <option value="10">10</option></select>&nbsp day';
                document.getElementById('rep').innerHTML = '';
                document.getElementById('repform').innerHTML= '';
                break;

            case "Every weekday (Mon-Fri)":
                document.getElementById('scheduledetails').style.display =  'block';
                document.getElementById('rec').innerHTML='';
                document.getElementById('recform').innerHTML='';
                document.getElementById('rep').innerHTML='';
                document.getElementById('repform').innerHTML='';
                break;

            case "Every Mon., Wed., and Fri.":
                document.getElementById('scheduledetails').style.display =  'block';
                document.getElementById('rec').innerHTML='';
                document.getElementById('recform').innerHTML='';
                document.getElementById('rep').innerHTML='';
                document.getElementById('repform').innerHTML='';
                break;

            case "Every Tues., and Thurs.":
                document.getElementById('scheduledetails').style.display =  'block';
                document.getElementById('rec').innerHTML='';
                document.getElementById('recform').innerHTML='';
                document.getElementById('rep').innerHTML='';
                document.getElementById('repform').innerHTML='';
                break;

            case "Weekly":
                document.getElementById('scheduledetails').style.display =  'block';
                document.getElementById('rec').innerHTML= "";
                document.getElementById('recform').innerHTML= '';
            // <select id="rec" name="Select1"><option value="1">1</option>      <option value="2">2</option>      <option value="3">3</option>      <option value="4">4</option>      <option value="5">5</option>      <option value="6">6</option>      <option value="7">7</option>      <option value="8">8</option>      <option value="9">9</option>      <option value="10">10</option></select>
                document.getElementById('rep').innerHTML='Repeat On:';
                document.getElementById('repform').innerHTML=
                '<input  id="sun" type="checkbox" />'+
                'S &nbsp;'+
                '<input id="mon" type="checkbox" />'+
                'M &nbsp;'+
                '<input id="tue" type="checkbox" />'+
                'T &nbsp;'+
                '<input id="wed" type="checkbox" />'+
                'W &nbsp;'+
                '<input id="thu" type="checkbox"  />'+
                'T &nbsp;'+
                '<input id="fri" type="checkbox" />'+
                'F &nbsp;'+
                '<input id="sat" type="checkbox" />'+
                'S &nbsp;'
                break;

            case "Monthly":
                document.getElementById('scheduledetails').style.display =  'block';
                document.getElementById('rec').innerHTML='Repeat every:';
                document.getElementById('recform').innerHTML= '<select id="rec" name="Select1"><option value="1">1</option>      <option value="2">2</option>      <option value="3">3</option>      <option value="4">4</option>      <option value="5">5</option>      <option value="6">6</option>      <option value="7">7</option>      <option value="8">8</option>      <option value="9">9</option>      <option value="10">10</option></select> &nbsp; month';
                document.getElementById('rep').innerHTML='Repeat By:';
                document.getElementById('repform').innerHTML='<input id="repdom" name="repmonth" type="radio" checked="checked" value="dom" />day of month&nbsp;&nbsp;<input id="repdow" name="repmonth" type="radio" value="dom" />day of week';
                break;

            case "Yearly":
                document.getElementById('scheduledetails').style.display =  'block';
                document.getElementById('rec').innerHTML = "Repeat every:";
                document.getElementById('recform').innerHTML = '<select id ="rec" name="Select1"><option value="1">1</option>      <option value="2">2</option>      <option value="3">3</option>      <option value="4">4</option>      <option value="5">5</option>      <option value="6">6</option>      <option value="7">7</option>      <option value="8">8</option>      <option value="9">9</option>      <option value="10">10</option></select>';
                document.getElementById('rep').innerHTML = '';
                document.getElementById('repform').innerHTML= '';
                break;
        }
    }

}

</script>

<SCRIPT language="javascript">

// This method gets a comma separated list of items in the right <select>.
function assign(sRight)
{
    var len = sRight.length;
    var strAssignees = "";
    for(i = 0; i < len; i++)
    {
        strAssignees = strAssignees + sRight.options[i].value + ",";
        //alert('strAssignees= '+ strAssignees);
    }
    // Remove the trailing comma.
    strAssignees = strAssignees.substr(0, strAssignees.length - 1);
    //alert('strAssignees= '+ strAssignees);
    return strAssignees;
    // assign the value to the object which will be returned back to the parent.
    //	window.close();
}

function onClickCancel()
{
    window.close();
}


function toRight(sLeft, sRight)
{
    var lLen = sLeft.length;
    var rLen = sRight.length;

    var insert = 1;
    var selectionCount = 0;
    var nonInsertCount = 0;
    for(i=0; i<lLen;i++)
    {
        if(sLeft.options[i].selected)
        {
            selectionCount++;
            //Check if it is present in the right select.
            var assignee = sLeft.options[i].value;
            insert = 1;
            for(j = 0;j < rLen; j++)
            {
                var value = sRight.options[j].value;
                if(value == assignee)
                {
                    insert = 0;
                }
            }
            if(insert != 0)
            {
                var anOption = document.createElement("OPTION");
                sRight.options.add(anOption);
                anOption.text = sLeft.options[i].text;
                anOption.value= sLeft.options[i].value;
            }
            else
            {
                nonInsertCount++;
            }
        }
    }
    if (insert == 0 && selectionCount == nonInsertCount) return false;
    sort(sRight);
    return true;
}

function removeFromList(select)
{
    var values = new Array();
    var text = new Array();
    var lLen = select.length;
    var ctr = 0;
    for(var i=0; i<lLen;i++)
    {
        if(select.options[i].selected) {
            select.options[i].text = "";
            select.options[i].value= "";
            select.options[i].selected = false;
        }
        else {
            values[ctr] = select.options[i].value;
            text[ctr] = select.options[i].text;
            ctr++;
        }
    }
    for(var i=0;i<ctr;i++) {
        select.options[i].text = text[i];
        select.options[i].value = values[i];
        select.options[i].selected = false;
    }
    select.length = ctr;
}

function sort(select)
{
    var len = select.length;
    for(i=0;i<len;i++) {
        for(j=0;j<len;j++) {
            if(select.options[i].text < select.options[j].text) {
                var tempText  = select.options[i].text;
                var tempValue = select.options[i].value;
                select.options[i].text = select.options[j].text;
                select.options[i].value= select.options[j].value;
                select.options[j].text = tempText;
                select.options[j].value = tempValue;
            }
        }
    }
}

</script>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>New Report Wizard</title>


<link rel="stylesheet" type="text/css" href="cal.css">


</head>

<body onload="calendarSetup();">
<form>
<div id="report" style="display:block;" >
    <table bgcolor="#D2E6D2">
        <tr>
            <td colspan="2" align="center"><h4>New Report Wizard</h4></td>
        </tr>

        <tr>
            <td >Report name: </td>
            <td ><input name="reportname" type="text"  id="reportname" value=" " size="33px" vspace="4"></td>
        </tr>

        <tr>
            <td>Description: </td><td><textarea name="reportdescription" cols="25" ></textarea></td>
        </tr>

        <tr>
            <td colspan="2">Report Type:</td>
        </tr>

        <tr>
            <td><INPUT align="left" TYPE=RADIO NAME="reportype" VALUE="custom" onClick="showreportselector(this.value);"  >Custoum Report</td><td><INPUT TYPE=RADIO NAME="reportype" VALUE="block" checked="checked" onClick="showreportselector(this.value);">Add Blocks</td>
        </tr>

        <tr>
            <td colspan="2" align="left">
                &nbsp;
                <div id="wizardholder" style="display:none;">Custom Report: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<input name="customfile" id="customfile" value="" size="21" type="file" ></div>

                <div id="blockselector" style="display:block;float:right">
                    <TABLE  id="Table1" height="200" style="border:thin; border:solid 1px; border-color: #CCCCCC;" cellSpacing="" cellPadding="0">

                        <TR>
                            <TD  height="15"></TD>
                            <TD  height="15"  align="center" style="font-weight:bold">Existing:</TD>
                            <TD  height="15"></TD>

                            <TD  height="15"  align="center" style="font-weight:bold">Selected:</TD>
                            <TD  height="15"></TD>
                        </TR>

                        <TR >
                            <TD  ></TD>
                            <TD ><SELECT id="sLeft" onkeydown="return onKeyDownLeft()"ondblclick="javascript:toRight(document.all.sLeft, document.all.sRight)"
                                         style="WIDTH: 150px; HEIGHT: 60%" tabIndex="2" multiple size="2" name="sLeft" >

                                <option value="block1" >Block 1</option>
                                <option value="block2" >Block 2</option>
                                <option value="block3" >Block 3</option>
                                <option value="block4" >Block 4</option>
                                <option value="block5" >Block 5</option>
                            </SELECT>
                            </TD>

                            <TD vAlign="middle" align="center"  ><INPUT class="move-to-btn" id="right" style="WIDTH: 35px; HEIGHT: 22px" onClick="javascript:toRight(document.all.sLeft, document.all.sRight)"
                                                                        type="button" value="--> " name="right"> <br><INPUT class="remove-btn" id="left" style="MARGIN-TOP: 4px; WIDTH: 35px; HEIGHT: 22px"
                                                                                                                            onclick="javascript:removeFromList(document.all.sRight)"  type="button" value="<-- " name="left"></TD>

                            <TD><SELECT id="sRight" name="blocks" ondblclick="javascript:removeFromList(document.all.sRight)" style="WIDTH: 150px; HEIGHT: 60%"
                                        tabIndex="5" multiple size="2" name="sRight" ></SELECT>					</TD>
                            <TD ></TD>
                        </TR>

                        <TR>

                            <TD  height="25"></TD>
                            <TD  height="25"></TD>
                            <TD  height="25"></TD>
                            <TD height="25"><INPUT class="cmd-btn sx" id="Button1" style="WIDTH: 60px" onClick="assign(document.getElementById('sRight'))"
                                                   type="button" value="  Assign  " name="btnAssign"> <INPUT class="cmd-btn sx" id="Button2" style="WIDTH: 60px" onClick="javascript:onClickCancel()" type="button" value="  Cancel  " name="btnCancel">					</TD>
                            <TD  height="25"></TD>
                        </TR>
                    </TABLE>

                </div>
            </td>
        </tr>

        <tr>
            <td ></td>
            <td align="center"><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<input style="WIDTH: 60px" type="button" value="Next" onClick="schedulepagenation();"></td>
        </tr>

    </table>


    <br>
</div>

<div id="schedule"  style="display:none;width:380; background-color:#D2E6D2">
<table  width="380">

    <tr>
        <td colspan="2" >Enter the email addresses of recepients, separated <br>by commas</td>
    </tr>

    <tr>
        <td></td>
        <td align="center"><textarea name="maillist" cols="24"></textarea></td>
    </tr>

    <tr>
        <td colspan="2" align="center"><br><h4>Schedule Your Report</h4></td>
    </tr>

    <tr>
        <td width="120">Start Date</td><td align="center">
        <input type="text" id="startdate" name="startdate" size="32"  value=""  onfocus="calendarSetup()">
        <img alt="" height="22" style="" onfocus="calendarSetup();" onmouseover="calendarSetup();" src="cal.gif" id="_start_date_img_cal">
    </td>
    </tr>

    <tr>
        <td width="120">Start Time:</td><td align="left">&nbsp;&nbsp;&nbsp;&nbsp;<select style="line-height:2px" name="starttime" size="1" >'
        + '<option value="00:00">12:00am</option>'
        + '<option value="00:30">12:30am</option>'
        + '<option value="01:00">1:00am</option>'
        + '<option value="01:30">1:30am</option>'
        + '<option value="02:00">2:00am</option>'
        + '<option value="02:30">2:30am</option>'
        + '<option value="03:00">3:00am</option>'
        + '<option value="03:30">3:30am</option>'
        + '<option value="04:00">4:00am</option>'
        + '<option value="04:30">4:30am</option>'
        + '<option value="05:00">5:00am</option>'
        + '<option value="05:30">5:30am</option>'
        + '<option value="06:00">6:00am</option>'
        + '<option value="06:30">6:30am</option>'
        + '<option value="07:00">7:00am</option>'
        + '<option value="07:30">7:30am</option>'
        + '<option value="08:00">8:00am</option>'
        + '<option value="08:30">8:30am</option>'
        + '<option value="09:00">9:00am</option>'
        + '<option value="09:30">9:30am</option>'
        + '<option value="10:00">10:00am</option>'
        + '<option value="10:30">10:30am</option>'
        + '<option value="11:00">11:00am</option>'
        + '<option value="11:30">11:30am</option>'
        + '<option value="12:00">12:00pm</option>'
        + '<option value="12:30">12:30pm</option>'
        + '<option value="13:00">1:00pm</option>'
        + '<option value="13:30">1:30pm</option>'
        + '<option value="14:00">2:00pm</option>'
        + '<option value="14:30">2:30pm</option>'
        + '<option value="15:00">3:00pm</option>'
        + '<option value="15:30">3:30pm</option>'
        + '<option value="16:00">4:00pm</option>'
        + '<option value="16:30">4:30pm</option>'
        + '<option value="17:00">5:00pm</option>'
        + '<option value="17:30">5:30pm</option>'
        + '<option value="18:00">6:00pm</option>'
        + '<option value="18:30">6:30pm</option>'
        + '<option value="19:00">7:00pm</option>'
        + '<option value="19:30">7:30pm</option>'
        + '<option value="20:00">8:00pm</option>'
        + '<option value="20:30">8:30pm</option>'
        + '<option value="21:00">9:00pm</option>'
        + '<option value="21:30">9:30pm</option>'
        + '<option value="22:00">10:00pm</option>'
        + '<option value="22:30">10:30pm</option>'
        + '<option value="23:00">11:00pm</option>'
        + '<option value="23:30">11:30pm</option>'
    </select></td>
    </tr>




    <tr>
        <td>Repeat</td><td align="center"><select name="reptype" style="width:218px" onChange="scheduletype(this.value)">
        <option>Does not repeat </option>
        <option>Daily </option>
        <option>Every weekday (Mon-Fri) </option>
        <option>Every Mon., Wed., and Fri. </option>
        <option>Every Tues., and Thurs. </option>
        <option>Weekly </option>
        <option>Monthly </option>
        <option>Yearly </option>
    </select></td>
    </tr>


</table>


<div  id="scheduledetails" style="display:none; width:380px; background-color:#D2E6D2">

    <table  bgcolor="#D2E6D2" width="380">

        <tr>
            <td width="137" id="rec"></td>
            <td id="recform" align="left"></td>
        </tr>

        <tr>
            <td id="rep"></td>
            <td id="repform"></td>
        </tr>

    </table>

</div>


<br>
<table  bgcolor="#D2E6D2" width="380"   style="border-top:thin; border:solid 1px; border-color: #CCCCCC;">
    <tr>
        <td width="120"></td>
        <td align="center"><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            <input type="button" style="WIDTH: 60px" value="Back" onClick="schedulepagenationback();">&nbsp;
            <input value="Finish" type="submit" onClick="submitform(this.form);" align="middle"></td>
    </tr>
</table>

</div>

</form>



</body>
</html>
