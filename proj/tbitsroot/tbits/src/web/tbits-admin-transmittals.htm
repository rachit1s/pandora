<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
    <head>
        <title>
            <%=title%>
        </title>
        <meta name="GENERATOR" content="Microsoft Visual Studio .NET 7.1">
        <meta name="vs_targetSchema" content="http://schemas.microsoft.com/intellisense/ie5">
        <link rel="stylesheet" type="text/css" media="screen" href="<%=nearestPath%>web/css/<%=cssFile%>" />
		
		<link rel="stylesheet" type="text/css" href="<%=nearestPath%>web/yui/build/fonts/fonts-min.css" />
		<link rel="stylesheet" type="text/css" href="<%=nearestPath%>web/yui/build/container/assets/skins/sam/container.css" />
		<link rel="stylesheet" type="text/css" href="<%=nearestPath%>web/yui/build/resize/assets/skins/sam/resize.css" />
		<link rel="stylesheet" type="text/css" href="<%=nearestPath%>web/yui/build/datatable/assets/skins/sam/datatable.css" />
		<link rel="stylesheet" type="text/css" href="<%=nearestPath%>web/yui/build/autocomplete/assets/skins/sam/autocomplete.css">
				
        <script language="javascript" src="<%=nearestPath%>web/scripts/admin.js"></script>
        <script language="javascript" src="<%=nearestPath%>web/scripts/messages.js"></script>
        <script language="javascript" src="<%=nearestPath%>web/scripts/common.js"></script>
        <script language="javascript" src="<%=nearestPath%>web/scripts/tt.js"></script>
        <script language="javascript" src="<%=nearestPath%>web/scripts/ac.js"></script>		
		<script type="text/javascript" src="<%=nearestPath%>web/scripts/json2.js"></script>
		<script language="javascript" src="<%=nearestPath%>web/scripts/add-report.js"></script>		
		<script type="text/javascript" src="<%=nearestPath%>web/scripts/admin-utils.js"></script>
		
        <script type="text/javascript" src="<%=nearestPath%>web/yui/build/yahoo/yahoo-min.js"></script>
		<script type="text/javascript" src="<%=nearestPath%>web/yui/build/yahoo-dom-event/yahoo-dom-event.js"></script>
		<script type="text/javascript" src="<%=nearestPath%>web/yui/build/element/element-min.js"></script>
		<script type="text/javascript" src="<%=nearestPath%>web/yui/build/dragdrop/dragdrop-min.js"></script>
		<script type="text/javascript" src="<%=nearestPath%>web/yui/build/datasource/datasource-min.js"></script>
		<script type="text/javascript" src="<%=nearestPath%>web/yui/build/datatable/datatable-min.js"></script>
		<script type="text/javascript" src="<%=nearestPath%>web/yui/build/utilities/utilities.js"></script>
		<script type="text/javascript" src="<%=nearestPath%>web/yui/build/container/container-min.js"></script>
		<script type="text/javascript" src="<%=nearestPath%>web/yui/build/resize/resize-min.js"></script>
		<script type="text/javascript" src="<%=nearestPath%>web/yui/build/animation/animation-min.js"></script>
		<script type="text/javascript" src="<%=nearestPath%>web/yui/build/autocomplete/autocomplete-min.js"></script>
		
		<script language="javascript">
			YAHOO.namespace("transbit.tbits");
	    	YAHOO.transbit.tbits.contextPath = "<%=nearestPath%>";
        </script>
		<script language="javascript">
			function openAddTrTemplate(){
				var addTemplateUrl = "<%=nearestPath%>add-transmittal-template/<%=sysPrefix%>?actionType=open";
				window.open(addTemplateUrl,'_blank','left=20, top=20, height=245, width=950,toolbar=no, location=no,status=yes, resize=yes, menubar=no, scrollbars=no,copyhistory=yes');
			}
	</script>
    </head>
    <body onLoad="onLoadBodyUsers();loadTrTables();"> <!-- main-navigator -->
        <FORM name="adminUsersForm" id="adminUsersForm" method="post">
            <input type="hidden" name="nearestPath" id="nearestPath" value="<%=nearestPath%>" />
            <DIV class="hb bhs" style="margin: 0ex 1ex 0.5ex 1ex;">
                <DIV class="hsp yui-skin-sam">
					<h2>tBits transmittal mappings</h2>						
					<div id="trMappings"></div><br>
					<!--div>
						<input type="button" value="Add Mapping" onClick="javascript:openAddTrMapping();">
					</div-->
					<h2>tBits transmittal templates</h2>
					<div id="trTemplates"></div><br>
					<div>
						<input type="button" value="Add Entry" onClick="javascript:openAddTrTemplate();">
					</div>
                </DIV>               
            </DIV>
            <DIV style="display: none;" id="allTypeFields" name="allTypeFields" width="100px">
                <%=allTypeFields%>
            </DIV>        
			</FORM>
		<script type="text/javascript">
			function loadTrTables(){
				YAHOO.tbits.transmittals.trMappingData = eval(<%=mappingData%>);
				YAHOO.tbits.transmittals.trTemplateData = eval(<%=templateData%>);
			}
		</script>
		
		<script type="text/javascript">
			YAHOO.namespace ("tbits.transmittals");
			YAHOO.tbits.transmittals.sysPrefixes = <%=sys_prefix_list%>;
			YAHOO.util.Event.addListener(window, "load", function() {
			YAHOO.tbits.transmittals.tableHandler = new function() {
			var myColumnDefs = [{key:"dtn", label:"Transmittal Business Area", formatter:"dropdown", dropdownOptions:YAHOO.tbits.transmittals.sysPrefixes, sortable:true},
								{key:"latest", label:"Latest Business Area", formatter:"dropdown", dropdownOptions:YAHOO.tbits.transmittals.sysPrefixes, sortable:true},
								{key:"save", label:"Save", formatter:YAHOO.widget.DataTable.formatButton},				
								{key:"delete",label:"Delete", formatter:function(elCell) {
									elCell.innerHTML = "<img src= \"/web/images/ckdeny.gif\" title= \"delete row\"/>";
									elCell.style.cursor = "pointer";
								}}];					
			this.myDataSource = new YAHOO.util.DataSource(YAHOO.tbits.transmittals.trMappingData);
			this.myDataSource.responseType = YAHOO.util.DataSource.TYPE_JSARRAY;
			this.myDataSource.responseSchema = {
				fields: ["dtn","latest","save"]
			};
		
			this.myDataTable = new YAHOO.widget.DataTable("trMappings",
					myColumnDefs, this.myDataSource, {caption:""});
					
			this.myDataTable.subscribe("cellDblclickEvent",this.myDataTable.onEventShowCellEditor);
			
			this.myDataTable.subscribe("dropdownChangeEvent", function(oArgs){ 
	            var elDropdown = oArgs.target; 
				var column = this.getColumn(elDropdown);
	            var oRecord = this.getRecord(elDropdown); 
	            oRecord.setData(column.key, elDropdown.options[elDropdown.selectedIndex].value); 
	        }); 
			
			this.myDataTable.subscribe("cellClickEvent",function(ev) {	
				var target = YAHOO.util.Event.getTarget(ev); 
				var column = this.getColumn(target);
				var arecord = this.getRecord(target);
				var dtnSysPrefix = arecord.getData("dtn");
				var latestSysPrefix = arecord.getData("latest");
				
				if (column.key == "save") {	
				    var comments = '';				
					if (dtnSysPrefix == 'none'){
						alert ("Please select proper transmittal business area for mapping and not 'none'.");
						return;									
						}
					if (latestSysPrefix == 'none'){
						comments = "Latest business area is set to 'none'. Hence no business area will be mapped as Latest for " + 				                                   "this transmittal mapping. Please ignore if not applicable.\n";
					}
										
					if (confirm(comments + "Are you sure you want to save the row ?")) {
						var query = "?actionType=mapTransmittals&dtnSysPrefix=" + dtnSysPrefix
											+"&latestSysPrefix=" + latestSysPrefix;
						var resp = executeHttpRequest ("GET", "<%=nearestPath%>add-transmittal-template/<%=sysPrefix%>"+ query,  false);	
						alert (resp);
					}
				}
				
				if (column.key == "delete") {
					if (confirm("Are you sure you want to delete the row ?")) {
						var query = "?actionType=deleteMapping";
						var resp = executeHttpRequest ("GET","<%=nearestPath%>add-transmittal-template/<%=sysPrefix%>" + query ,false);	
						if (eval (resp) == true) {							
							this.deleteRow(target);	
							window.location.reload( false );					
						}
					}
				} 
			});
			};
		});
		</script>
		<script>
			YAHOO.util.Event.addListener(window, "load", function() {
			YAHOO.tbits.transmittals.templateTableHandler2 = new function() {
			var myColumnDefs2 = [{key:"template_id", label:"Template Id", sortable:true},
								{key:"template_name", label:"Template name", sortable:true},
								{key:"file_name", label:"Template file name", sortable:true},
								{key:"to_list", label:"Assignees", sortable:true},
								{key:"cc_list", label:"Subscribers", soratble:true},
								{key:"edit", label:"Edit", formatter:YAHOO.widget.DataTable.formatButton},			
								{key:"delete",label:"Delete", formatter:function(elCell) {
									elCell.innerHTML = "<img src= \"/web/images/ckdeny.gif\" title= \"delete row\"/>";
									elCell.style.cursor = "pointer";
								}}];					
			this.myDataSource2 = new YAHOO.util.DataSource(YAHOO.tbits.transmittals.trTemplateData);
			this.myDataSource2.responseType = YAHOO.util.DataSource.TYPE_JSARRAY;
			this.myDataSource2.responseSchema = {
				fields: ["template_id","template_name","file_name","to_list","cc_list","edit"]
			};
		
			this.myDataTable2 = new YAHOO.widget.DataTable("trTemplates",
					myColumnDefs2, this.myDataSource2, {caption:""});
					
			this.myDataTable2.subscribe("cellDblclickEvent",this.myDataTable2.onEventShowCellEditor);
			this.myDataTable2.subscribe("cellClickEvent",function(ev) {	
				var target = YAHOO.util.Event.getTarget(ev); 
				var column = this.getColumn(target);
				var arecord = this.getRecord(target);
				
				if (column.key == "edit") {
					var editTemplateUrl = "<%=nearestPath%>add-transmittal-template/<%=sysPrefix%>?actionType=edit&template_name=" + arecord.getData("template_name");
					window.open(editTemplateUrl,'_blank','left=20, top=20, height=245, width=950,toolbar=no, location=no,status=yes, resize=yes, menubar=no, scrollbars=no,copyhistory=yes');
				}
				
				if (column.key == "delete") {
					if (confirm("Are you sure you want to delete the row ?")) {
						var query = "?actionType=delete&template_id=" + arecord.getData("template_id");
						var resp = executeHttpRequest ("GET","<%=nearestPath%>add-transmittal-template/<%=sysPrefix%>" + query ,false);	
						if (eval (resp) == true) {							
							this.deleteRow(target);
						}
					}
				}
			});
			};
		});
		</script>
    </body>
</html>
