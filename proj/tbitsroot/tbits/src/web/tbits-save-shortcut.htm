<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
    <head>
        <title>Save As</title>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <link rel="stylesheet" type="text/css" media="screen" href="<%=nearestPath%>web/css/<%=cssFile%>" />
        <script language="javascript" src="<%=nearestPath%>web/scripts/common.js"></script>
        <script type="text/javascript" src="<%=nearestPath%>web/yui/build/yahoo/yahoo-min.js"></script>
	<script language="javascript">
		YAHOO.namespace("transbit.tbits");
	    	YAHOO.transbit.tbits.contextPath = "<%=nearestPath%>";
        </script>
    </head>
    <script language="javascript">
        <%=scList%>
        
        function trim(str)
        {
	        str = str.replace(/^\s+/, "");
	        str = str.replace(/\s+$/, "");
	        return str;
        }
        
        function onClickCancel()
        {
            window.close();
            return -1;
        }
        
        function onClickSave()
        {
            var scName = new String(trim(document.getElementById("shortcutName").value));
            if (scName == "")
            {
                alert(SEARCH_CRITERIA_NAME_MANDATORY);
                return 0;
            }
            
            if (validateSCName(scName) == false)
            {
                alert(INVALID_SEARCH_CRITERIA_NAME);
                return 0;
            }
            
            var baShortcut = isChecked("isBAWide");
            if (baShortcut == true)
            {
                if (baShortcutList[scName.toUpperCase()] != null)
                {
                    var result = confirm(DUPLICATE_NAME_OVERWRITE);
                    if (result == false) 
                    {
                        document.getElementById("shortcutName").focus();
                        return;
                    }
                }
            }
            else
            {
                // Check if the shortcut name is already present.
                if (scList[scName.toUpperCase()] != null)
                {
                    var result = confirm(DUPLICATE_NAME_OVERWRITE);
                    if (result == false) 
                    {
                        document.getElementById("shortcutName").focus();
                        return;
                    }
                }
            }
            
            var sysPrefix = document.getElementById("sysPrefix").value;
            var view = document.getElementById("view").value;
            var desc = document.getElementById("description").value;
            var filter = document.getElementById("filter").value;
            var query = document.getElementById("query").value;
            var listAll = document.getElementById("listAll").value;

            var isDefault = isChecked("isDefault");
            var isPublic = isChecked("isPublic");
            var isBAWide = isChecked("isBAWide");

            var url = 
                "<%=nearestPath%>shortcut-handler/" + sysPrefix        + 
                "?request="          + "save"           +
                "&sysPrefix="        + sysPrefix        + 
                "&scName="           + scName           + 
                "&view="             + view             + 
                "&query="            + escape(query)    + 
                "&description="      + escape(desc)     + 
                "&filter="           + filter           + 
                "&isDefault="        + isDefault        + 
                "&isPublic="         + isPublic         + 
                "&listAll="          + listAll          + 
                "&isBAWide="         + isBAWide         +
                "&now="              + getCurrentTime();
            var output = executeHttpRequest("GET", url, false);
            if (output.indexOf("true") >= 0)
            {
                window.close();
                return;
            }
            else
            {
                alert(SAVE_SEARCH_FAILED);
                return;
            }
        }
        
        function isChecked(ctrlName)
        {
            var ctrl = document.getElementById(ctrlName);
            if (ctrl)
            {
                if (ctrl.checked == true)
                    return true;
                return false;
            }
            return false;
        }
        
        function onKeyDownBody(e)
        {
            var event = (document.all) ? window.event : e;
            var keyCode = (document.all) ? event.keyCode : e.which;
            if (keyCode == 13)
            {
                return onClickSave();
            }
            else if (keyCode == 27)
            {
                return onClickCancel();
            }
        }

        function toggleCheckBox(chbox)
        {
            var ctrl = document.getElementById(chbox);
            if (ctrl != null && ctrl.disabled == false)
            {
                if (ctrl.checked == true) ctrl.checked = false;
                else ctrl.checked = true;
            }
        }
        
        function markedPublic()
        {
            document.getElementById("isBAWide").disabled = (isChecked("isPublic") || isChecked("isDefault"));
        }
        
        function markedDefault()
        {
            document.getElementById("isBAWide").disabled = (isChecked("isPublic") || isChecked("isDefault"));
        }
        
        function markedBAWide()
        {
            var checked = isChecked("isBAWide");
            document.getElementById("isPublic").disabled = checked;
            document.getElementById("isDefault").disabled = checked;
        }
    </script>
    <body class="dialog bh" onkeydown="onKeyDownBody(event)" onload="document.getElementById('shortcutName').focus();">
        <input type="hidden" name="sysPrefix" id="sysPrefix" value="<%=sysPrefix%>" /> <input type="hidden" name="view" id="view" value="<%=view%>" />
        <input type="hidden" name="description" id="description" value="<%=description%>" />
        <input type="hidden" name="filter" id="filter" value="<%=filter%>" /> <input type="hidden" name="query" id="query" value="<%=query%>" />
        <input type="hidden" name="listAll" id="listAll" value="<%=listAll%>" />
        <table id="Table1" cellSpacing="0" cellPadding="0" width="100%" border="0">
            <tr>
                <td class="sx">Search name</td>
                <td style="padding-left: 5px;">
                    <input class="sx" id="shortcutName" style="WIDTH: 95%" type="text" size="20" name="shortcutName"
                        maxlength="50">
                </td>
            </tr>
            <tr>
                <td></td>
                <td>
                    <INPUT class="sx" id="isDefault" type="checkbox" name="isDefault" onclick="markedDefault();"/>&nbsp;
                    <span class="sx" onclick="toggleCheckBox('isDefault');markedDefault();">Set as default</span>
                </td>
            </tr>
            <tr>
                <td></td>
                <td>
                    <INPUT class="sx" id="isPublic" type="checkbox" name="isPublic" onclick="markedPublic();"/>&nbsp;
                    <span class="sx" onclick="toggleCheckBox('isPublic');markedPublic();">Mark as shared</span>
                </td>
            </tr>
            <tr style="display: <%=baWideShortcut%>">
                <td></td>
                <td>
                    <INPUT class="sx" id="isBAWide" type="checkbox" name="isBAWide" onclick="markedBAWide()"/>&nbsp;
                    <span class="sx" onclick="toggleCheckBox('isBAWide');markedBAWide()">Mark as analyst-search for this business area</span>
                </td>
            </tr>
            <tr>
                <td>&nbsp;</td>
                <td>&nbsp;</td>
            </tr>
            <tr>
                <td></td>
                <td>
                    <input class="sx" id="Submit" style="WIDTH: 63px" class="default-btn" type="button" value="Save"
                        name="save" onclick="onClickSave()" /> <input class="sx" class="cmd-btn" type="button" value="Cancel" name="cancel" style="WIDTH:63px"
                        ID="Cancel" onclick="onClickCancel()" />
                </td>
            </tr>
            <tr>
                <td></td>
                <td></td>
            </tr>
        </table>
    </body>
    <script language="javascript" src="<%=nearestPath%>web/scripts/messages.js"></script>
</html>
