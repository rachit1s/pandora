<html>
  <head>
    <title><%=title%></title>
    <meta content="http://schemas.microsoft.com/intellisense/ie5" name="vs_targetSchema"/>
		<link href="<%=nearestPath%>web/css/<%=cssFile%>" media="screen" type="text/css" rel="stylesheet"/>
		<link rel="stylesheet" type="text/css" media="screen" href="<%=nearestPath%>web/css/<%=cssFile%>" />
		<link rel="stylesheet" type="text/css" href="<%=nearestPath%>web/yui/build/fonts/fonts-min.css" />
		<link rel="stylesheet" type="text/css" href="<%=nearestPath%>web/yui/build/container/assets/skins/sam/container.css" />
		<link rel="stylesheet" type="text/css" href="<%=nearestPath%>web/yui/build/resize/assets/skins/sam/resize.css" />
		<link rel="stylesheet" type="text/css" href="<%=nearestPath%>web/yui/build/datatable/assets/skins/sam/datatable.css" />
		<link rel="stylesheet" type="text/css" href="<%=nearestPath%>web/css/dialogpanel.css">
		<link type="text/css" rel="stylesheet" href="<%=nearestPath%>web/cron-editor/cronEditor.css">
		
		<link rel="stylesheet" type="text/css" href="<%=nearestPath%>web/yui/build/paginator/assets/skins/sam/paginator.css" />
		
		<script src="<%=nearestPath%>web/scripts/admin.js" language="javascript"></script>
	    <script src="<%=nearestPath%>web/scripts/messages.js" language="javascript"></script>
	    <script src="<%=nearestPath%>web/scripts/common.js" language="javascript"></script>
	    <script src="<%=nearestPath%>web/scripts/tt.js" language="javascript"></script>
	    <script src="<%=nearestPath%>web/scripts/ac.js" language="javascript"></script>
	    <script src="<%=nearestPath%>web/scripts/usermgmt.js" language="javascript"></script>
        
		
		
    	<script type="text/javascript" src="<%=nearestPath%>web/yui/build/yahoo/yahoo-min.js"></script>
		<script type="text/javascript" src="<%=nearestPath%>web/yui/build/yahoo-dom-event/yahoo-dom-event.js"></script>
		<script type="text/javascript" src="<%=nearestPath%>web/yui/build/dragdrop/dragdrop-min.js"></script>
		<script type="text/javascript" src="<%=nearestPath%>web/yui/build/utilities/utilities.js"></script>
		<script type="text/javascript" src="<%=nearestPath%>web/yui/build/container/container.js"></script>
		<script type="text/javascript" src="<%=nearestPath%>web/yui/build/resize/resize.js"></script>
		<script type="text/javascript" src="<%=nearestPath%>web/yui/build/element/element-min.js"></script>
		<script type="text/javascript" src="<%=nearestPath%>web/yui/build/datasource/datasource-min.js"></script>
		<script type="text/javascript" src="<%=nearestPath%>web/yui/build/datatable/datatable-min.js"></script>
		<script type="text/javascript" src="<%=nearestPath%>web/scripts/dialogpanel.js"></script>
		<script type="text/javascript" src="<%=nearestPath%>web/yui/build/yahoo/yahoo-min.js"></script>
		<script type="text/javascript" src="<%=nearestPath%>web/yui/build/json/json-min.js"></script>
		<script type="text/javascript" src="<%=nearestPath%>web/scripts/AddListJobDialogpanel.js"></script>
		<script type="text/javascript" language="javascript" src="<%=nearestPath%>web/cron-editor/cronEditor.nocache.js"></script>
	    
		<script type="text/javascript" src="<%=nearestPath%>web/yui/build/paginator/paginator-min.js"></script>
	 
	<script>
	   YAHOO.namespace("transbit.tbits");
    YAHOO.transbit.tbits.contextPath = "<%=nearestPath%>";
	</script>
	
	<style>
  th{
    text-align:left;
    font-size:12px;
  }
	
  #addJobPage 
  {
    position: absolute; 
    top: 10px; 
    left: 300px; 
    display:block; 
    overflow:hidden; 
    z-index:999; 
    display:none; 
    background:#ECF5FA;
    border:1px solid #8899DD;
  }
  
  #addJobPageBody 
  {
    display:block; 
    overflow:auto; 
    width:440px; 
    height:440px; 
  }
  
  * html #addJobPageBody
  {
    width:450px;
    w\idth:450px;
  }
  
  #CaptionsForm{
    padding:0;
    margin:10px;
    display:block;
    overflow:hidden;
    width:410px;
  }
  
  #addJobPageHeader{
    background:#8899DD; 
    display:block; 
    overflow:hidden; 
    width:430px; 
    height:15px;
    padding:5px; 
    color:#fff; 
    font-weight:bold;
  }
  
  * html #addJobPageHeader
  {
    width:450px;
    w\idth:450px;
    height:25px;
    h\eight:15px;
  }
  
  #cronTestResult{
    padding:5px;
    overflow:hidden;
    display:block;
    color:#fff;
  }

	</style>
	
	
		
        </head>
		
		<body onLoad="onLoadBody(); getTable();"> <!-- main-navigator -->
            <DIV class="hb bhs" style="margin: 0ex 1ex 0.5ex 1ex"> <!-- properties -->
                <DIV class ="hsp yui-skin-sam">
                   <div>
						<h2>System Jobs</h2>	
					</div>
					<div>
						<input type="button" value="Create job" onClick="javascript:CreateJob();">
					
					    <input  type="button"  value="Edit job" onClick="javascript:EditJob();">
						
					    <input type="button" value="Execute" onClick="javascript:ExecuteJob();">
						
					    <input type="button" value="Delete" onClick="javascript:DeleteJob();" >
					
					</div>
					
					<div id="basic"></div><br>
					
					<div>
						<input type="button" value="Create job" onClick="javascript:CreateJob();">
					
					    <input  type="button"  value="Edit job" onClick="javascript:EditJob();">
						
					    <input type="button" value="Execute" onClick="javascript:ExecuteJob();">
						
					    <input type="button" value="Delete" onClick="javascript:DeleteJob();" >
					
					</div>
				  <div id="addJobPage">
				    <div id="addJobPageHeader">
				      <div style="float:left; display:inline; width:100px;">Add Job</div>
				      <div style="float:right; display:inline; width:12px;"><img alt="close" src="images/clstry2.gif" onClick="OnClose();"/></div>
				    </div>
				    <div id="addJobPageBody">
  			      <form method="post" id="CaptionsForm" name="CaptionsForm" action="">
    			      <input type="hidden" name="subaction" value="" />
    			      <input type="hidden" name="preJobName" value="" />
    			      <input type="hidden" name="preJobGroup" value="" />
    			      <input type="hidden" id="page_name" value="details" name="page_name"/>
    			      <input id="cronExpression" name="cronExpression" value="" type="hidden">
                <input type="hidden" value="50001" id="selected_user_id" name="selected_user_id"/>
                <table>
                  <tr>
                		<th>Job Class</th>
                		<td>
                      <select name="className" id="class-name" onChange="getJobParams()">
                      </select>
                    </td>
                	</tr> 
                	<tr>
                    <th>Other Job Class</th>
    		            <td><input type="text" id="otherTR" name="otherJobClass" value="" /></td>
                  </tr>
                  <tr>
                    <th>Group</th>
    		            <td><input type="text" id="q" name="jobGroup" value=""/></td>
                  </tr>
                  <tr>
                		<th>Name</th>
                		<td><input type="text" name="jobName" value=""/> </td>
                	</tr>																				
                  <tr>
                		<th>Description</th>
                		<td><textarea name="description" value="" rows="3" cols="40"></textarea></td>
                	</tr>
                </table>
                <table id="parameterTable">
                  <tr>
                		<th>Parameter Name</th>
                		<th>Value</th>	
                	</tr>
                	<tr>
                		<td></td>
                		<td><input type="button" value="more..." onClick="AddParamRow()" /></td>	
                	</tr>
                </table>
                <table>
              		<tr>
                		<td>
                      <div id="cron-container"> </div>
                      <!-- <input id="cronExpression" name="cronExpression" value="" type="text">-->
                		  <input type="button" onClick="onTestCron()" id="test-cron" name="Test Expression" value="Test Expression"/>
                    </td>
              	  </tr>
              	</table>
                <table>
                  <tr>
                		<th style="height:60px;">Cron Results </th>
                		<td style="height:60px;"><div id="cronTestResult"/></div></td>
                	</tr>		
                	<tr>
                		<td class="sx">
                      <input type="button" name="action" value="Save Job" id="save-job" onClick="onSubmit();"/>
                    </td>
                		<td align="left">
                		  <input type="button" name="cancel" value="Cancel" id="cancel" onClick="OnClose();"/>
                    </td>
    							</tr>				
                </table>
              </form>
            </div>
			    </div>
				</DIV>               
            </DIV>
            <DIV style="display: none;" id="allTypeFields" name="allTypeFields" width="100px">
                <%=allTypeFields%>
            </DIV>
	  
		<script type="text/javascript">
			function getTable(){
        var rTable = executeHttpRequest("POST","<%=nearestPath%>ListJobhandler", false);
				YAHOO.tbits.ListJob.ListJobData = eval(rTable);	
			}
		</script>
		<script type="text/javascript">
		
		YAHOO.namespace ("tbits.ListJob");
		YAHOO.tbits.ListJob.selectedJob="";
		YAHOO.tbits.ListJob.selectedJobGroup="";
		YAHOO.util.Event.addListener (window, "load", function() {
		YAHOO.tbits.ListJob.tableHandler = new function() {
			
			// custom formatter
			
			this.myCustomFormatter = function(elCell,oRecord, oColumn, oData) {	
		       if(oRecord.getData("job_state") == "Running")
					{
				     elCell.innerHTML = "<img src= \"<%=nearestPath%>web/images/pause.gif\" title= \"Pause Job\"/>";
					 elCell.style.cursor = "pointer";                                                  
				    }
			  else
				   {
				     elCell.innerHTML = "<img src= \"<%=nearestPath%>web/images/play.gif\" title= \"play Job\"/>";
				     elCell.style.cursor = "pointer"; 
				   }
									
			  } ;
			
			// custom formatter end 
			
			// shortcut for custom formatter
			YAHOO.widget.DataTable.Formatter.myCustom = this.myCustomFormatter; 
			
			var myColumnDefs = [
                  {key:"radio", formatter:"radio",label:""}, 
									{key:"Action",formatter:"myCustom"}, 
									{key:"job_name", label:"Job Name", sortable:true},
									{key:"Job_group", label:"Job Group", sortable:true},
									{key:"description", label:"Description",sortable:true},
									{key:"Job_class_name", label:"JobClass",sortable:true}
									]
			
     		
			this.myDataSource = new YAHOO.util.DataSource(YAHOO.tbits.ListJob.ListJobData);
			this.myDataSource.responseType = YAHOO.util.DataSource.TYPE_JSARRAY;
			this.myDataSource.responseSchema = {
					fields: ["job_state","job_name","Job_group","description","Job_class_name"]
				};
			var myConfigs = {
                   paginator: new YAHOO.widget.Paginator({
                   rowsPerPage: 10,
                   template: YAHOO.widget.Paginator.TEMPLATE_ROWS_PER_PAGE,
                   rowsPerPageOptions: [5,10,15,20]
                   //pageLinks: 5
                   })
				   }
			this.myDataTable = new YAHOO.widget.DataTable("basic",myColumnDefs, this.myDataSource,myConfigs);
			
			var lastSelectedRadioRecord = null; 
	        this.myDataTable.subscribe("radioClickEvent", function(oArgs){ 
	            if(lastSelectedRadioRecord) { 
                lastSelectedRadioRecord.setData("radio",false); 
	            } 
	            var elRadio = oArgs.target; 
	            var oRecord = this.getRecord(elRadio); 
	            oRecord.setData("radio",true);
				lastSelectedRadioRecord = oRecord;
				YAHOO.tbits.ListJob.selectedJob = oRecord.getData("job_name");
				YAHOO.tbits.ListJob.selectedJobGroup = oRecord.getData("Job_group");
				});
			// raido button Function  end
				
		// pause -Resume button event.
				
				//this.myDataTable.subscribe("cellDblclickEvent",this.myDataTable.onEventShowCellEditor);
				
				this.myDataTable.subscribe("cellClickEvent",function(ev) {	
				
					var target = YAHOO.util.Event.getTarget(ev); 
					var column = this.getColumn(target);
					var arecord = this.getRecord(target);
					var key = column.key;
					var rData = arecord.getData("job_state");
					
					if((key=='Action') && (rData=='Running'))
					  {
					 
					     var query = "?action=pause-job&jobName=" + arecord.getData("job_name")+
								  "&jobGroup="+arecord.getData("Job_group");
								  
					     var resp = executeHttpRequest("GET","<%=nearestPath%>all-job-actions"+ query ,false); 
					     alert("Job Paused.");
						 location.reload(true);
							 if(eval(resp)  == true)
						       {
						        alert("Job paused.");
						       }
						 }
				    if((key=='Action')&&(rData=='Pause'))
					 {
					    var Query = "?action=resume-job&jobName="+arecord.getData("job_name")+
					             "&jobGroup="+arecord.getData("Job_group");
					    var resp = executeHttpRequest("GET","<%=nearestPath%>all-job-actions"+Query ,false); 
						alert("job resumed.");
						location.reload(true);
						  if(eval(resp) == true)
						  {
						    alert("Resume job");
						  } 
				     }
				});		
		}();
	});
	
</script>

		<script type="text/javascript">
			YAHOO.util.Event.onDOMReady(initAddJobPage);
		</script>	
    <br />
		<br />
		<br />
		<br />
</body>
        </html>
