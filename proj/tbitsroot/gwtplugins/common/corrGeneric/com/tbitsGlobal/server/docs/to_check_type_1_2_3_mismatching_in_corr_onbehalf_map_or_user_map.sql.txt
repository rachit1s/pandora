declare @sys_prefix varchar(50)
declare @column_name varchar(50)
declare @table_name varchar(50)

set @sys_prefix = 'Malwa_Corr'		-- name of the ba to check
set @table_name = 'corr_user_map'	-- name of the table to check
set @column_name = 'user_map_type1'	-- name of the column of the table to check

declare @query varchar(4000)

set @query = 'select com.* from ' + @table_name + ' com
 join corr_field_name_map cfnm on cfnm.sys_prefix = com.sys_prefix and cfnm.corr_field_name = ''' + @column_name + '''
 join business_areas ba on ba.sys_prefix = com.sys_prefix
 join fields f on f.sys_id = ba.sys_id and f.name = cfnm.field_name
 left join types t on t.sys_id = ba.sys_id and t.field_id = f.field_id and t.name = com.' + @column_name + '
 where ba.sys_prefix = ''' + @sys_prefix + ''' and t.name is null'

print @query

exec( @query )

