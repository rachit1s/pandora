<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
    <head>
        <title>
            <%=title%>
        </title>
        <meta name="vs_targetSchema" content="http://schemas.microsoft.com/intellisense/ie5">  

		<!--  TODO: (lokesh, please) minimize this list. --Giris  --> 
		<link rel="stylesheet" type="text/css" media="screen" href="<%=nearestPath%>web/css/<%=cssFile%>" />
		<link rel="stylesheet" type="text/css" href="<%=nearestPath%>web/yui/build/fonts/fonts-min.css" />
		<link rel="stylesheet" type="text/css" href="<%=nearestPath%>web/yui/build/container/assets/skins/sam/container.css" />
		<link rel="stylesheet" type="text/css" href="<%=nearestPath%>web/yui/build/resize/assets/skins/sam/resize.css" />
		<link rel="stylesheet" type="text/css" href="<%=nearestPath%>web/yui/build/datatable/assets/skins/sam/datatable.css" />
		<link rel="stylesheet" type="text/css" href="<%=nearestPath%>web/css/dialogpanel.css" />
    <link rel="stylesheet" type="text/css" href="<%=nearestPath%>web/yui/build/logger/assets/skins/sam/logger.css">
    <link rel="stylesheet" type="text/css" href="<%=nearestPath%>web/yui/build/treeview/assets/skins/sam/treeview.css">
    <link rel="stylesheet" type="text/css" href="<%=nearestPath%>web/yui/build/button/assets/skins/sam/button.css">
    <link rel="stylesheet" type="text/css" href="<%=nearestPath%>web/yui/build/autocomplete/assets/skins/sam/autocomplete.css">
	
	<link rel="stylesheet" type="text/css" href="<%=nearestPath%>web/yui/build/paginator/assets/skins/sam/paginator.css" />
		
		<script type="text/javascript" src="<%=nearestPath%>web/yui/build/yahoo-dom-event/yahoo-dom-event.js"></script>
		<script type="text/javascript" src="<%=nearestPath%>web/yui/build/dragdrop/dragdrop-min.js"></script>
		<script type="text/javascript" src="<%=nearestPath%>web/yui/build/utilities/utilities.js"></script>
		<script type="text/javascript" src="<%=nearestPath%>web/yui/build/container/container.js"></script>
		<script type="text/javascript" src="<%=nearestPath%>web/yui/build/resize/resize.js"></script>
		<script type="text/javascript" src="<%=nearestPath%>web/yui/build/element/element-min.js"></script>
		<script type="text/javascript" src="<%=nearestPath%>web/yui/build/datasource/datasource-min.js"></script>
		<script type="text/javascript" src="<%=nearestPath%>web/yui/build/datatable/datatable-min.js"></script>
		<script type="text/javascript" src="<%=nearestPath%>web/yui/build/yahoo/yahoo-min.js"></script>
    <script type="text/javascript" src="<%=nearestPath%>web/yui/build/yuiloader/yuiloader-min.js"></script>
    <script type="text/javascript" src="<%=nearestPath%>web/yui/build/yahoo/event.js"></script>
    <script type="text/javascript" src="<%=nearestPath%>web/yui/build/event/event-min.js"></script>
    <script type="text/javascript" src="<%=nearestPath%>web/yui/build/dom/dom-min.js"></script>
    <script type="text/javascript" src="<%=nearestPath%>web/yui/build/logger/logger-min.js"></script>
    <script type="text/javascript" src="<%=nearestPath%>web/yui/build/button/button-min.js"></script>
    <script type="text/javascript" src="<%=nearestPath%>web/yui/build/treeview/treeview-min.js"></script>
    <script type="text/javascript" src="<%=nearestPath%>web/yui/build/animation/animation-min.js"></script> 
    <script type="text/javascript" src="<%=nearestPath%>web/yui/build/autocomplete/autocomplete-min.js"></script>
    <script type="text/javascript" src="<%=nearestPath%>web/yui/build/yahoo/connection.js"></script>
    <script type="text/javascript" src="<%=nearestPath%>web/yui/build/json/json-min.js"></script>
	
	<script type="text/javascript" src="<%=nearestPath%>web/yui/build/paginator/paginator-min.js"></script>
		
    <script type="text/javascript" src="<%=nearestPath%>web/scripts/dialogpanel.js"></script>
		<script type="text/javascript" src="<%=nearestPath%>web/scripts/common.js"></script>
		<script type="text/javascript" src="<%=nearestPath%>web/scripts/add-report.js"></script>
    <script type="text/javascript" src="<%=nearestPath%>web/scripts/admin.js"></script>
    <script type="text/javascript" src="<%=nearestPath%>web/scripts/messages.js"></script>
    <script type="text/javascript" src="<%=nearestPath%>web/scripts/common.js"></script>
    <script type="text/javascript" src="<%=nearestPath%>web/scripts/tt.js"></script>
    <script type="text/javascript" src="<%=nearestPath%>web/scripts/ac.js"></script>
    <script type="text/javascript" src="<%=nearestPath%>web/scripts/usermgmt.js"></script>
    <script type="text/javascript" src="<%=nearestPath%>web/scripts/AddReportDialogpanel.js"></script>
    <script type="text/javascript" src="<%=nearestPath%>web/scripts/json2.js"></script>
    <script type="text/javascript" src="<%=nearestPath%>web/scripts/tasknode.js"></script>
	
  <script language="javascript">
		YAHOO.namespace("transbit.tbits");
	  YAHOO.transbit.tbits.contextPath = "<%=nearestPath%>";
	    
	  var ba = <%=baRoleMap%>;
  	var userList =  <%=usersList%>;
  	var selectedBARoles = <%=selectedBARoles%>;	
    </script>

	<style type="text/css">
	.ygtvcheck0 { background: url(<%=nearestPath%>web/images/yui-images/check/check0.gif) 0 0 no-repeat; width:16px; cursor:pointer }
	.ygtvcheck1 { background: url(<%=nearestPath%>web/images/yui-images/check/check1.gif) 0 0 no-repeat; width:16px; cursor:pointer }
	.ygtvcheck2 { background: url(<%=nearestPath%>web/images/yui-images/check/check2.gif) 0 0 no-repeat; width:16px; cursor:pointer }
</style>
	<style>
  th{
    text-align:left;
    font-size:12px;
  }
	
  #addReportsPage 
  {
    position: absolute; 
    top: 10px; 
    left: 200px; 
    display:block; 
    overflow:hidden; 
    z-index:999; 
    display:none; 
    background:#ECF5FA;
    border:1px solid #8899DD;
  }
  
  #addReportsPageBody 
  {
    display:block; 
    overflow:hidden; 
    width:550px; 
    max-height:560px; 
  }
  
  * html #addReportsPageBody
  {
    width:560px;
    w\idth:560px;
    height:560px;
  }
  
  #addReportFormId{
    padding:0;
    margin:10px;
    display:block;
    overflow:hidden;
    width:520px;
  }
  
  #addReportsPageHeader{
    background:#8899DD; 
    display:block; 
    overflow:hidden; 
    width:540px; 
    height:15px;
    padding:5px; 
    color:#fff; 
    font-weight:bold;
  }
  
  * html #addReportsPageHeader
  {
    width:560px;
    w\idth:560px;
    height:25px;
    h\eight:15px;
  }

	</style>
    </head>
    <body onLoad="onLoadBody(); getTable();" style="height:600px; display:block; overflow:hidden;"> <!-- main-navigator -->
      <DIV class="hb bhs" style="margin: 0ex 1ex 0.5ex 1ex;"><!-- properties -->
          <DIV class="hsp yui-skin-sam">
          <div>
						<h2>tBits Reports</h2>	
					</div>
					<div>
              <input type="button" value="Add Report" onClick="javascript:openAddReportWizard();" 
				      title="Pops up a dialog box for adding a new report.">
					   
					   <input type="button" value="Edit" onClick="javascript:EditReport();" 
					   title="Pops up a dialog box for Edit selected report." >
					
					   <!--<input  type="button"  value="Schedule" onClick="javascript:ScheduleReport();" 
				    title ="Pops up a dialog box for schedule selected report.">-->
						
					   <input type="button" value="Save selected" onClick="javascript:SaveReport();"
					   title="Click to save selected report">
						
					   <input type="button" value="Delete" onClick="javascript:DeleteReport();" 
					   title="Click to Delete selected report." >
					</div>
					<div id="basic"></div>
					<div>
						<input type="button" value="Add Report" onClick="javascript:openAddReportWizard();"
						title="Pops up a dialog box for adding a new report.">
						
						<input type="button" value="Edit" onClick="javascript:EditReport();" 
						title="Pops up a dialog box for Edit selected report">
					
				    <!--<input  type="button"  value="Schedule" onClick="javascript:ScheduleReport();" 
				    title ="Pops up a dialog box for schedule selected report.">-->
					
				    <input type="button" value="Save selected" onClick="javascript:SaveReport();" 
				    title="Click to save selected report">
					
				    <input type="button" value="Delete" onClick="javascript:DeleteReport();" 
				    title="Click to Delete selected report." >
					</div>
				</div>
			</div>
					<div id="addReportsPage">
				    <div id="addReportsPageHeader">
				      <div style="float:left; display:inline; width:100px;">Add Job</div>
				      <div style="float:right; display:inline; width:12px;"><img alt="close" src="images/clstry2.gif" onClick="OnClose();"/></div>
				    </div>
				    <div id="addReportsPageBody">
  			      <form id="addReportFormId"  name = "addReportForm" enctype="multipart/form-data" method="post"> 
    			      <input type="hidden" name="nearestPath" id="nearestPath" value="<%=nearestPath%>" />
                <input type="hidden" id= "selectedBARoleMap" name="selectedBARoles" value="">
        			  <input type="hidden" id="includeUsersList" name="includeList" value="">
        			  <input type="hidden" id="excludeUsersList" name="excludeList" value="">
        			  <input type="hidden" id="isChangedId" name="isChanged" value="false">	
        			  <input type="hidden" name="requestType" value="" ID="requestTypeId">
        			  <input type="hidden" id="reportId" name="reportId" value="">
                <table>
                  <tr>
                    <th>Report Name</th>
    		            <td><input type="text" id="q" name="report-name" value=""/></td>
                  </tr>
				  <tr>
                    <th>Group Name</th>
    		            <td><input type="text" name="group-name" value=""/></td>
                  </tr>
                  <tr>
                		<th>Description</th>
                		<td><input type="text" name="report-description" value=""/> </td>
                	</tr>
                	<tr>
                		<th>Current report file name</th>
                		<td>
                      <span id="old-file-name"></span>
                      <input type="button" name="change_file" value="Replace" onClick="javascript:toggleBrowse()">
                    </td>
                	</tr> 																				
                  <tr>
                		<th>Please specify a file</th>
                		<td><input type="file" name="report-file" onChange="javascript:setChanged()" size="40"/></td>
                	</tr>
                	</tr> 																				<tr>
                		<th>Enable</th>
                		<td><input id ="is_enable" name="is_enable" type="checkbox" /></td>
                	</tr>
                	</tr> 																				<tr>
                		<th>is private</th>
                		<td><input id="is_private_id" name="is_private"  type="checkbox" onClick = "javascript:toggleElement('is_private_table')"/></td>
                	</tr>
                </table>
                <table id="is_private_table" style="display:none;">
                  <tr>
                		<th>Business Area-Roles</th>
                		<th>Include Users</th>
                    <th>Exclude Users</th>		
                	</tr>
                	<tr>
                  	<td style="vertical-align:top;">
        							<div class="promo" style="width:100%; border:thin inset">																	
        							<div class="example-container module">
        								<div id="example-canvas" class="bd">										
        									<div id="treeDiv1" style="height:200px;overflow:auto;"></div>																
        								</div>									
        							</div>			
        						</div>	
        						</td>
        						<td style="vertical-align:top;">			
        							<select multiple name="inUserSelection" id="includeUsers" style="width:100%;height:200px;">
        							</select>							
        						</td>
        						<td style="vertical-align:top">
        							<select multiple name="exUserSelection" id="excludeUsers" style="width:100%;height:200px">
        							</select>
        						</td>	
                  </tr>
                  <tr>
                  	<td></td>
        						<td>
        							<div class=" yui-skin-sam">
        								<b>Add/Remove user</b>
        								<div id="userautocomplete1">
        									<input id="userinput1" name="user-input1" type="text">
        									<div id="usercontainer1"></div>
        								</div>	
        							</div>
        							<input id="add1" type="button" name="adduser1" value="Add" onClick="javascript:addUser('userinput1', 'includeUsers')" style="margin-top:25px;">	
        							<input id="remove1" type="button" name="removeUser1" value="Remove" onClick="javascript:removeUser('includeUsers');" style="margin-top:25px;">
        						</td>
        						<td>
        							<div class=" yui-skin-sam">
        								<b>Add/Remove user</b>
        								<div id="userautocomplete2">
        									<input id="userinput2"  name="user-input2" type="text">
        									<div id="usercontainer2"></div>
        								</div>
        							</div>
        							<input id="add2" type="button" name="adduser2" value="Add" onClick="javascript:addUser('userinput2', 'excludeUsers')" style="margin-top:25px;">	
        							<input id="remove2" type="button"  name="removeUser2" value="Remove" onClick="javascript:removeUser('excludeUsers');" style="margin-top:25px;">
        						</td>
                  </tr>
                </table>
                <table>	
                	<tr>
                		<td>
                      <input id="saveReport" name="Save" type="button" value="Save" onClick="javascript:setAction()" />
                    </td>
                		<td align="left">
                		  <input type="button" name="cancel" value="Cancel" id="cancel" onClick="OnClose();"/>
                    </td>
    							</tr>				
                </table>
            </div>
			    </div>
        <br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br />
		<script type="text/javascript">
			function getTable(){
				var rTable = executeHttpRequest("POST","<%=nearestPath%>reportstable?reportView=admin", false);
				YAHOO.tbits.reports.reportsData = eval(rTable);	
			}
		</script>

		<script type="text/javascript">
		YAHOO.namespace ("tbits.reports");
		
		YAHOO.tbits.reports.selectedReportid="";
		YAHOO.tbits.reports.selectedName = "";
		YAHOO.tbits.reports.selectedGroup = "";
		YAHOO.tbits.reports.selectedDescription = "";
		YAHOO.tbits.reports.selectedFilename =  "";
		YAHOO.tbits.reports.selectedIsprivate = "";
		YAHOO.tbits.reports.selectedEnabled = "";
		
		
		YAHOO.util.Event.addListener(window, "load", function() {
			YAHOO.tbits.reports.tableHandler = new function() {
				var myColumnDefs = [{key:"radio",formatter:"radio",label:""},
				                    {key:"report_id",label:"Id", sortable:true},
									{key:"name", label:"Name", sortable:true, editor:"textbox"},
									{key:"group_name", label:"Group", sortable:true, editor:"textbox"},
									{key:"description", label:"Description", width:200, sortable:true, editor:"textbox"},
									{key:"filename", sortable:true,label:"Report filename"},
									{key:"is_private", label:"Private", disable:true},
									{key:"enabled", label:"Enable", formatter:"checkbox"}
										
									];							
				this.myDataSource = new YAHOO.util.DataSource(YAHOO.tbits.reports.reportsData);
				this.myDataSource.responseType = YAHOO.util.DataSource.TYPE_JSARRAY;
				this.myDataSource.responseSchema = {
					fields: ["report_id","name","description","filename","is_private","enabled","group_name"]
				};
		         var myConfigs = {
                   paginator: new YAHOO.widget.Paginator({
                   rowsPerPage: 10,
                   template: YAHOO.widget.Paginator.TEMPLATE_ROWS_PER_PAGE,
                   rowsPerPageOptions: [5,10,15,20]
                   //pageLinks: 5
                   })
				   }
				 
				this.myDataTable = new YAHOO.widget.DataTable("basic",
						myColumnDefs, this.myDataSource,myConfigs);
				
				this.myDataTable.subscribe("checkboxClickEvent", function(oArgs){	
					var elCheckbox = oArgs.target;
					var oRecord = this.getRecord(elCheckbox);
					var column = this.getColumn(elCheckbox);
					if (column.key == "enabled")
						oRecord.setData("enabled", elCheckbox.checked);			
					if (column.key == "is_private")	
						oRecord.setData("is_private", elCheckbox.checked);	
				});
				
		//button click event start
		
				this.myDataTable.subscribe("buttonClickEvent", function(oArgs){			
					var oRecord = this.getRecord(oArgs.target);
					var column = this.getColumn(oArgs.target);
					if (column.key == "edit"){
						var url1 = "<%=nearestPath%>addreportwizard?requestType=edit&reportId=" + oRecord.getData("report_id");
						window.open(url1,'_blank','left=20, top=20, height=600, width=900,toolbar=yes, location=yes,status=yes,                        resize=yes, menubar=yes, scrollbars=yes,copyhistory=yes');	
					}
					if (column.key == "schedule"){
						var url2 = "<%=nearestPath%>reportcirculation?&actionType=edit&reportName="+oRecord.getData("name")+                         "&reportfile="+oRecord.getData("filename");
						window.open(url2,'_blank','left=20, top=20, height=600, width=900,toolbar=yes, location=yes,status=yes,                        resize=yes, menubar=yes, scrollbars=yes,copyhistory=yes');	
					}
					if (column.key == "save"){
						var query = "?action=update&reportId=" + oRecord.getData ("report_id") 
									+ "&reportName=" + oRecord.getData ("name") + "&description=" + oRecord.getData("description")
									+ "&fileName=" + oRecord.getData("filename") + "&isPrivate=" + oRecord.getData("is_private") 
									+ "&isEnabled=" + oRecord.getData("enabled");
						var resp = executeHttpRequest ("GET","<%=nearestPath%>reportstablemodifier" + query ,false);	
						if (eval (resp) == true) {							
							alert ("Saved");						
						}
						else{
							alert ("Could not save");
						} 
					}
					//alert(YAHOO.lang.dump(oRecord.getData()));
				});	
							
	 //button click event end
	
			// cell click event start
						
				this.myDataTable.subscribe("cellDblclickEvent",this.myDataTable.onEventShowCellEditor);
				this.myDataTable.subscribe("cellClickEvent",function(ev) {	
					var target = YAHOO.util.Event.getTarget(ev); 
					var column = this.getColumn(target);
					var arecord = this.getRecord(target);
					if (column.key == "delete") {
						if (confirm("Are you sure you want to delete the report: \"" + arecord.getData ("name") + "\"?")) {
							var query = "?action=delete&reportId=" + arecord.getData("report_id");
							var resp = executeHttpRequest ("GET","<%=nearestPath%>reportstablemodifier" + query ,false);	
							if (eval (resp) == true) {							
								this.deleteRow(target);													
							}
						}
					} /*else {
						//this.myDataTable.onEventShowCellEditor(ev);
					}*/
				});
			// cell click event end
				
				// radio button click event start
				var lastSelectedRadioRecord = null; 
				this.myDataTable.subscribe("radioClickEvent", function(oArgs){ 
	               if(lastSelectedRadioRecord) { 
                      lastSelectedRadioRecord.setData("radio",false); 
	                  } 
	            var elRadio = oArgs.target; 
	            var oRecord = this.getRecord(elRadio); 
	            oRecord.setData("radio",true);
				lastSelectedRadioRecord = oRecord;
				YAHOO.tbits.reports.selectedReportid = oRecord.getData("report_id");
				YAHOO.tbits.reports.selectedName = oRecord.getData("name");
				YAHOO.tbits.reports.selectedGroup  =  oRecord.getData("group_name");
				YAHOO.tbits.reports.selectedDescription = oRecord.getData("description");
				YAHOO.tbits.reports.selectedFilename =  oRecord.getData("filename");
				YAHOO.tbits.reports.selectedIsprivate = oRecord.getData("is_private");
				YAHOO.tbits.reports.selectedEnabled  =  oRecord.getData("enabled");
				
				
				
				//alert("row Selected");
				});
				// radio button click event end
				
			};
		});
		
		var usersList = <%=usersList%>;		
		YAHOO.example.ACJSArray1 = autoCompleteFunction ('userinput1', 'usercontainer1');
		YAHOO.example.ACJSArray2 = autoCompleteFunction ('userinput2', 'usercontainer2');		
		
		function autoCompleteFunction (userinput, usercontainer){
			// Instantiate second JS Array DataSource
			this.oACDS = new YAHOO.widget.DS_JSArray(usersList);
										
			// Instantiate first AutoComplete
			this.oAutoComp = new YAHOO.widget.AutoComplete(userinput,usercontainer, this.oACDS);
			this.oAutoComp.prehighlightClassName = "yui-ac-prehighlight";
			this.oAutoComp.typeAhead = true;
			this.oAutoComp.useShadow = true;
			this.oAutoComp.minQueryLength = 0;
			this.oAutoComp.textboxFocusEvent.subscribe(function(){
				var sInputValue = YAHOO.util.Dom.get(userinput).value;
				if(sInputValue.length === 0) {
					var oSelf = this;
					setTimeout(function(){oSelf.sendQuery(sInputValue);},0);
				}
			});								
		}
	</script>	
    </body>
</html>
